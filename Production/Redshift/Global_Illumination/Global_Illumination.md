Global Illumination

# 全局照明(Global Illumination)

## 基本概念

在现实生活中，光子源自光源，从许多表面上弹起，由这些表面修饰的颜色，最终到达我们的眼睛。 在计算机图形学中，全球照明（GI）试图模拟这些光子弹跳相互作用。 这种模拟增添了现实主义的照明，并帮助实现更多的生活般的图像。

即使在非常简单的场景下，GI也可以产生深远的影响，如下所示：

| 没有 GI                                    | 有 GI。 注意颜色的混合。                           |
| ---------------------------------------- | ---------------------------------------- |
| ![img](http://docs.redshift3d.com/Content/Resources/Images/I/3000169.png) | ![img](http://docs.redshift3d.com/Content/Resources/Images/I/3000170.png) |

到达物体表面而没有任何反弹的光被称为直接照明。 一旦光已经从一个或多个表面反弹，它被称为间接光照。 所以GI基本上计算的是间接照明。

当光子撞到粗糙的表面时，它会随机散乱。 这称为漫射全局照明。 当光子撞击强反射或折射表面（如镜子或玻璃）时，往往具有更可预测的反弹方向。 因此，反射/折射表面反弹的光子往往被“聚集”在一起，形成有趣的照明模式。 这些模式叫做焦散。 全球照明一般是指这两种影响：漫反射GI和焦散.

上图所示的图像使用漫反射GI点亮，而下图使用焦散。

焦散(Caustics)

![img](http://docs.redshift3d.com/Content/Resources/Images/I/3000171.png)

 

Redshift分别处理漫射GI和焦散。

漫射全局照明可以通过以下技术的组合来实现：

- 光子映射(Photon mapping)
- 蛮力(Brute-Force)
- 辐射缓存(Irradiance caching)
- 辐射点云(Irradiance point cloud)

另一方面，焦散只能用此技术来实现

- 光子映射(Photon mapping)

在Redshift中，所有这些技术都被称为“GI引擎”。 每个GI引擎都有其利弊。 这些在本文档中进一步列出。

## 一级和二级GI引擎

在上述技术中，光子映射是唯一一种类似于现实生活中的照明如何工作的技术，即它从灯光中射出光子。 所有其他技术的工作方式相反：他们从相机中射出光线，将它们反弹并最终击中光线。

当这些相机光线撞击物体时，使用主GI引擎。 如果GI需要多次反弹，则使用二次GI引擎进行这些反弹。 下图显示了当对主要和次要GI引擎启用“强力”时发生的情况。

零GI弹跳。 相机拍摄光线并击中墙壁（点“A”）。 使用主GI引擎，并射出另一根以红色显示的光线。 这样，地板上的直接照明（点“B”）会影响“A”点。

![img](http://docs.redshift3d.com/Content/Resources/Images/I/3000172.png)

一个GI反弹。 现在的处理进一步。 点“B”使用二次GI引擎通过拍摄单个射线（以蓝色显示）从球体收集照明。 这样，地板（点“B”）和球体（点“C”）的直接照明会影响点“A”。

![img](http://docs.redshift3d.com/Content/Resources/Images/I/3000173.png)

从光线射出的光子或从我们眼睛射出的光线在某些方面是相当的。 如果您翻转所有箭头的方向，就好像照明来自光源，从球体，地板，墙壁上弹出，然后到达相机！

那么为什么要分开一级和二级GI引擎？ 主要GI照明的结果直接对于相机可见，因此需要尽可能高质量。 另一方面，次GI照明通常代表最终照明的最小部分，因此它可以承受较低质量（认为“模糊”或“嘈杂”），而不会引入显着的视觉神器。 显著的性能和有时的品质优势！

请注意，以上示例仅显示“暴力”发生的情况。 其他GI引擎对于A，B，C点做不同的事情。这些在每项技术文档中都有更详细的描述。

 

## 主要全局照明设置

启用GI的起点是选择主要和次要GI引擎，并指定GI反弹次数。

在您的场景中引入更多的GI反弹通常会使您的照明更亮 - 渲染速度更慢。 它也倾向于“洗出”照明一点。 由于这些原因，用户有时会选择限制弹跳次数。

下面显示的场景包含几个垂直的瓷砖，其中一个亮着强烈的聚光灯。 最大的视觉差异（对于这个特定场景）在0和1 GI反弹之间。 请注意以下图像使用Irradiance Caching为主GI引擎和Irradiance Point Cloud为次要GI引擎渲染。

| 零GI弹跳。 正确的瓷砖通过中心照明瓷砖上的直接照明而亮起。           | 一个GI反弹。 正确的瓷砖上的间接照明现在正在反弹一次，并照亮左边的瓷砖。 地板下方的地板现在也会收到额外的照明。 | 两个GI反弹。 左瓦片的间接照明正在影响它们下方的地面。 与零和一个GI反弹之间的差异相比，效果肯定比较微妙。 |
| ---------------------------------------- | ---------------------------------------- | ---------------------------------------- |
| ![img](http://docs.redshift3d.com/Content/Resources/Images/I/3000174.png) | ![img](http://docs.redshift3d.com/Content/Resources/Images/I/3000175.png) | ![img](http://docs.redshift3d.com/Content/Resources/Images/I/3000176.png) |

选择主要和次要GI引擎后，您需要配置它们。 有关详细信息，请参阅下列主题：

[Photon Mapping](http://docs.redshift3d.com/Content/I/The%20Photon%20Mapping%20GI%20Engine.html#Start)

[Brute Force](http://docs.redshift3d.com/Content/I/The%20Brute%20Force%20GI%20Engine.html#Start)

[Irradiance Caching](http://docs.redshift3d.com/Content/I/The%20Irradiance%20Cache%20GI%20Engine.html#Start)

[Irradiance Point Cloud](http://docs.redshift3d.com/Content/I/The%20Irradiance%20Point%20Cloud.html#Start)

## 推荐设置

一些用户可以被众多的选择所压倒。 并将要求最佳设置。

虽然不同的场景会有不同的要求，但我们发现一个很好的起点是：

- 将主GI引擎设置为“强力”
- 将次级GI引擎设置为“辐射点云”
- 将“跳数数”设置为2或3
- 如果您的场景需要焦散（玻璃或镜子），请参阅光子映射主题的焦散部分。

作为经验法则，请尝试记住以下有关GI质量的信息：

- 包含几个（不太强）的光的场景通常可以使用相当低的GI设置（光线数，样本数等）
- 包含非常少，非常强的灯光的场景将需要更积极的GI设置。 例如，“单亮瓦”的场景以上需要很多的光线来得到一个干净的结果，因为它几乎完全是间接照明，并且仅使用一个单一的非常强的光。
- 与环境着色器（如“物理天空”）照亮的室外场景通常可以使用相当低的GI设置
- 总结以上所有：大量的照明对比度需要更高质量的设置，较低的对比度可以使用质量较差的设置

## 不同技术的优缺点

（有关各种技术如何工作的更多信息，请查看各自的页面）

### Photon Mapping

这种技术类似于现实生活中光的行为。 在一个阶段，它从光源射出光子，在场景中弹起光子并将它们存储在表面上。 然后，在第二阶段，渲染器使用这些光子渲染最终图像。

优点

- 提供了很好的控制
- 对于合理数量的光子，它渲染速度快

缺点

- 光子映射是一种过时的技术
- 光子必须存储在GPU存储器中，所以太多的光子在存储器使用方面可能是禁止的
- 有几个设置要进行调整，可能需要一些实验来获得干净的结果
- 光子的处理时间和存储可能会被浪费，这些光子最终不会被相机看到

### Brute-Force

蛮力与光子映射相反。 而不是从光线中射出光子，它会从每个表面射出一些光线并反射光线。

优点

- 非常精准
- 动画中没有闪烁
- 这很容易，因为它只有一个设置来调整（“Num Rays”）
- 不需要任何存储，所以最终的图像分辨率和场景细节无关紧要

缺点

- 这是最慢的技术。 但是由于Redshift的速度，与其他渲染器相比更为实用。
- 除非每像素拍摄许多光线，否则会产生粒状图像，特别是在困难的照明情况下

### Irradiance Caching

全局照明通常在表面上缓慢变化。 这意味着彼此相邻的几个像素可以“共享”相同的值，这又意味着我们不需要为每个像素计算单独的GI值！ 辐射缓存利用了这一事实，并计算GI与类似于Brute-Force的GI，但是在图像周围的稀疏点，这意味着计算需要更少的时间。

优点

- 可以产生平滑的图像，比Brute-Force快几倍
- 结果可以保存到每个动画帧的磁盘。 因此，如果您正在调整像抗锯齿，光泽数字光线，数字区域光线样本和其他质量参数（与GI无关），您可以简单地加载GI结果并快速迭代。
- 很多场景大部分都是平坦的。 例如：建筑内部的墙壁。 或者汽车的表面。 辐照缓存在这些场景中将具有显着的性能优势。
- 增加最终的图像分辨率通常不会增加辐射高速缓存时间线性地依赖于场景复杂度和辐照缓存设置。即 从1280x720到2560x1400（即像素的4倍），您可能会发现辐照缓存处理时间少于4倍

缺点

- 辐射缓存点在单独的渲染过程中计算，因此不可能进行交互式反馈。
- 射出太少的蛮力射线显示为噪点，射出太少的光线会使辐照度缓存显示为“斑点”并在动画中闪烁。 视觉上这些可以会比噪点更加分散注意力。
- 有几个用户参数控制点间距。 设置这些是正确才能无斑点和无闪烁。 学习如何使用这些设置通常涉及到试错。
- 如果场景有很多细节（例如：叶子覆盖屏幕的大部分），则可能需要创建太多的点。 这使得辐射缓存的优点无效，并且对存储器资源造成很大的负担，因为必须存储点。 对于这些场景，暴力可能是一个更好的选择。

### Irradiance Point Cloud

辐射点云只能用作二级GI引擎。 其目的是为主GI引擎提供更快更清洁的二次照明。 您可能已经在其他渲染器中看到了类似的技术，称为“Importons”，“Irradiance Particles”或“Light Cache”。 虽然Redshift的辐射点云的工作方式与这些技术不同，但它的目的是提高多重反弹GI的质量和效率。

优点

- 有助于使Brute-Force和Irradiance缓存更快更干净
- 某些非常困难的照明场景只能用这种技术渲染！ （即他们会用纯粹的强力技术花费很长的时间）

缺点

- 需要一些存储（但通常不太多）
- 有几个设置要进行调整，因此需要进行一些实验。
- 仅当需要多次反弹时才能提供好处，如果场景包含大量的灯光或照明条件困难的话

## 节约反射能源(Conserve Reflections Energy)

Redshift目前不支持全局照明计算中的反射光线采样，这可能导致能量损失。 检查“节能反射能量”选项使得能够在GI计算期间增加将丢失的反射能量（即，反射色彩色调）到材料的漫射色调的廉价技巧。 这给出反射射线反射对GI有贡献的错觉，这可以使得强烈或有色的材料反射特别明显。

 

 

------

Copyright © 2016 Redshift Rendering Technologies, Inc.